<div class="py-2 px-2 sm:py-4 sm:px-4 md:py-4 md:px-4">
    <div class="max-w-4xl">

        <!-- Re-ordering Section -->
        <div class="mb-4" *ngIf="isReOrdering">
            <div class="bg-amber-50 border border-amber-200 rounded-xl p-3 sm:p-4 md:p-6">
                <div class="flex items-center gap-2 sm:gap-3 md:gap-4 mb-4">
                    <div class="">
                        <i class="pi pi-refresh text-amber-600 text-base sm:text-lg"></i>
                    </div>
                    <h2 class="text-sm sm:text-base md:text-lg font-semibold text-amber-800">Re-ordering Options</h2>
                </div>

                <div class="flex items-center gap-2 sm:gap-3 mb-4 sm:mb-6">
                    <p-checkbox
                            [(ngModel)]="keepSameInfo"
                            binary="true"
                            inputId="keepSameInfo"
                            class="custom-checkbox">
                    </p-checkbox>
                    <label for="keepSameInfo" class="text-slate-700 text-xs sm:text-sm font-medium cursor-pointer">
                        Keep the same order information
                    </label>
                </div>

                <p-button
                        label="Proceed to Payment"
                        icon="pi pi-arrow-right"
                        iconPos="right"
                        (click)="proceedToReOrder()"
                        styleClass="w-full md:w-fit">
<!--                        [loading]="isCreatingOrder"-->
<!--                        [disabled]="isCreatingOrder || checkoutForm.invalid"-->
                </p-button>
            </div>
        </div>

        <!-- Main Form -->
        <div *ngIf="!keepSameInfo">
            <form [formGroup]="checkoutForm" class="space-y-4 sm:space-y-6 md:space-y-8">
                <!-- Customer Information -->
                <div class="bg-white border border-slate-200 p-2">
                    <div class="px-3 py-3 sm:px-4 sm:py-4 md:px-6 md:py-4">
                        <div class="flex items-center gap-2 sm:gap-3">
                            <div class="">
                                <i class="pi pi-user text-blue-600 text-sm sm:text-base"></i>
                            </div>
                            <h3 class="text-sm sm:text-base md:text-lg font-semibold text-slate-800">Customer Information</h3>
                        </div>
                    </div>

                    <div class="p-3 sm:p-4 md:p-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6">
                            <div class="form-field">
                                <label for="email" class="block text-xs sm:text-sm font-semibold text-slate-700 mb-2">
                                    Email Address <span class="text-red-500">*</span>
                                </label>
                                <div class="relative">
                                    <input
                                            id="email"
                                            type="email"
                                            pInputText
                                            formControlName="email"
                                            [class.ng-invalid]="isFieldInvalid('email')"
                                            placeholder="Enter your email"
                                            class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors text-sm sm:text-base">
                                    <i class="pi pi-envelope absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 text-sm"></i>
                                </div>
                                <small
                                        *ngIf="isFieldInvalid('email')"
                                        class="text-red-500 text-xs mt-1 block">
                                    {{ getFieldError('email') }}
                                </small>
                            </div>

                            <div class="form-field">
                                <label for="phone" class="block text-xs sm:text-sm font-semibold text-slate-700 mb-2">
                                    Phone Number
                                </label>
                                <div class="relative">
                                    <input
                                            id="phone"
                                            type="tel"
                                            pInputText
                                            formControlName="phone"
                                            placeholder="Enter your phone number"
                                            class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors text-sm sm:text-base">
                                    <i class="pi pi-phone absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 text-sm"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Shipping Address -->
                <div class="bg-white border border-slate-200 rounded-xl shadow-sm p-2" formGroupName="shipping">
                    <div class="px-3 py-3 sm:px-4 sm:py-4 md:px-6 md:py-4">
                        <div class="flex items-center gap-2 sm:gap-3">
                            <div class="">
                                <i class="pi pi-send text-green-600 text-sm sm:text-base"></i>
                            </div>
                            <h3 class="text-sm sm:text-base md:text-lg font-semibold text-slate-800">Shipping Address</h3>
                        </div>
                    </div>

                    <div class="p-3 sm:p-4 md:p-6">
                        <div class="space-y-4 sm:space-y-6">
                            <div class="form-field">
                                <label for="shippingFullName" class="block text-xs sm:text-sm font-semibold text-slate-700 mb-2">
                                    Full Name <span class="text-red-500">*</span>
                                </label>
                                <input
                                        id="shippingFullName"
                                        type="text"
                                        pInputText
                                        formControlName="fullName"
                                        [class.ng-invalid]="isNestedFieldInvalid('shipping', 'fullName')"
                                        placeholder="Enter your full name"
                                        class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors text-sm sm:text-base">
                                <small
                                        *ngIf="isNestedFieldInvalid('shipping', 'fullName')"
                                        class="text-red-500 text-xs mt-1 block">
                                    {{ getNestedFieldError('shipping', 'fullName') }}
                                </small>
                            </div>

                            <div class="form-field">
                                <label for="shippingAddress1" class="block text-xs sm:text-sm font-semibold text-slate-700 mb-2">
                                    Address <span class="text-red-500">*</span>
                                </label>
                                <input
                                        id="shippingAddress1"
                                        type="text"
                                        pInputText
                                        formControlName="address1"
                                        [class.ng-invalid]="isNestedFieldInvalid('shipping', 'address1')"
                                        placeholder="Street address"
                                        class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors text-sm sm:text-base">
                                <small
                                        *ngIf="isNestedFieldInvalid('shipping', 'address1')"
                                        class="text-red-500 text-xs mt-1 block">
                                    {{ getNestedFieldError('shipping', 'address1') }}
                                </small>
                            </div>

                            <div class="form-field">
                                <label for="shippingAddress2" class="block text-xs sm:text-sm font-semibold text-slate-700 mb-2">
                                    Address Line 2
                                </label>
                                <input
                                        id="shippingAddress2"
                                        type="text"
                                        pInputText
                                        formControlName="address2"
                                        placeholder="Apartment, suite, etc."
                                        class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors text-sm sm:text-base">
                            </div>

                            <!-- Country-State-City Selector for Shipping -->
                            <div class="form-field">
                                <label class="block text-xs sm:text-sm font-semibold text-slate-700 mb-2">
                                    Location <span class="text-red-500">*</span>
                                </label>
                                <div class="bg-slate-50 border border-slate-300 rounded-lg p-3 sm:p-4">
                                    <app-country-state-city-selector
                                            [showLabels]="false"
                                            [showSelectedTags]="true"
                                            [required]="true"
                                            [showClearButtons]="true"
                                            (selectionChange)="onShippingLocationChange($event)"
                                    >
                                    </app-country-state-city-selector>
                                </div>
                                <small
                                        *ngIf="isNestedFieldInvalid('shipping', 'country') || isNestedFieldInvalid('shipping', 'state') || isNestedFieldInvalid('shipping', 'city')"
                                        class="text-red-500 text-xs mt-1 block">
                                    Please select a complete location (country, state, city)
                                </small>
                            </div>

                            <div class="form-field">
                                <label for="shippingPostalCode" class="block text-xs sm:text-sm font-semibold text-slate-700 mb-2">
                                    Postal Code <span class="text-red-500">*</span>
                                </label>
                                <input
                                        id="shippingPostalCode"
                                        type="text"
                                        pInputText
                                        formControlName="postalCode"
                                        [class.ng-invalid]="isNestedFieldInvalid('shipping', 'postalCode')"
                                        placeholder="Enter postal code"
                                        class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors text-sm sm:text-base">
                                <small
                                        *ngIf="isNestedFieldInvalid('shipping', 'postalCode')"
                                        class="text-red-500 text-xs mt-1 block">
                                    {{ getNestedFieldError('shipping', 'postalCode') }}
                                </small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Billing Address -->
                <div class="bg-white border border-slate-200 rounded-xl shadow-sm p-2">
                    <div class="px-3 py-3 sm:px-4 sm:py-4 md:px-6 md:py-4">
                        <div class="flex items-center gap-2 sm:gap-3">
                            <div class="">
                                <i class="pi pi-credit-card text-purple-600 text-sm sm:text-base"></i>
                            </div>
                            <h3 class="text-sm sm:text-base md:text-lg font-semibold text-slate-800">Billing Address</h3>
                        </div>
                    </div>

                    <div class="p-3 sm:p-4 md:p-6">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 sm:p-4 mb-4 sm:mb-6">
                            <div class="flex items-center gap-2 sm:gap-3">
                                <p-checkbox
                                        formControlName="sameAsShipping"
                                        binary="true"
                                        (onChange)="onSameAsShippingChange()"
                                        inputId="sameAsShipping"
                                        class="custom-checkbox">
                                </p-checkbox>
                                <label for="sameAsShipping" class="text-slate-700 text-xs sm:text-sm font-medium cursor-pointer">
                                    Same as shipping address
                                </label>
                            </div>
                        </div>

                        <div *ngIf="!checkoutForm.get('sameAsShipping')?.value" formGroupName="billing" class="space-y-4 sm:space-y-6">
                            <div class="form-field">
                                <label for="billingFullName" class="block text-xs sm:text-sm font-semibold text-slate-700 mb-2">
                                    Full Name <span class="text-red-500">*</span>
                                </label>
                                <input
                                        id="billingFullName"
                                        type="text"
                                        pInputText
                                        formControlName="fullName"
                                        [class.ng-invalid]="isNestedFieldInvalid('billing', 'fullName')"
                                        placeholder="Enter your full name"
                                        class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-colors text-sm sm:text-base">
                                <small
                                        *ngIf="isNestedFieldInvalid('billing', 'fullName')"
                                        class="text-red-500 text-xs mt-1 block">
                                    {{ getNestedFieldError('billing', 'fullName') }}
                                </small>
                            </div>

                            <div class="form-field">
                                <label for="billingAddress1" class="block text-xs sm:text-sm font-semibold text-slate-700 mb-2">
                                    Address <span class="text-red-500">*</span>
                                </label>
                                <input
                                        id="billingAddress1"
                                        type="text"
                                        pInputText
                                        formControlName="address1"
                                        [class.ng-invalid]="isNestedFieldInvalid('billing', 'address1')"
                                        placeholder="Street address"
                                        class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-colors text-sm sm:text-base">
                                <small
                                        *ngIf="isNestedFieldInvalid('billing', 'address1')"
                                        class="text-red-500 text-xs mt-1 block">
                                    {{ getNestedFieldError('billing', 'address1') }}
                                </small>
                            </div>

                            <div class="form-field">
                                <label for="billingAddress2" class="block text-xs sm:text-sm font-semibold text-slate-700 mb-2">
                                    Address Line 2
                                </label>
                                <input
                                        id="billingAddress2"
                                        type="text"
                                        pInputText
                                        formControlName="address2"
                                        placeholder="Apartment, suite, etc."
                                        class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-colors text-sm sm:text-base">
                            </div>

                            <!-- Country-State-City Selector for Billing -->
                            <div class="form-field">
                                <label class="block text-xs sm:text-sm font-semibold text-slate-700 mb-2">
                                    Location <span class="text-red-500">*</span>
                                </label>
                                <div class="bg-slate-50 border border-slate-300 rounded-lg p-3 sm:p-4">
                                    <app-country-state-city-selector
                                            [showLabels]="false"
                                            [showSelectedTags]="true"
                                            [required]="true"
                                            [showClearButtons]="true"
                                            (selectionChange)="onBillingLocationChange($event)">
                                    </app-country-state-city-selector>
                                </div>
                                <small
                                        *ngIf="isNestedFieldInvalid('billing', 'country') || isNestedFieldInvalid('billing', 'state') || isNestedFieldInvalid('billing', 'city')"
                                        class="text-red-500 text-xs mt-1 block">
                                    Please select a complete location (country, state, city)
                                </small>
                            </div>

                            <div class="form-field">
                                <label for="billingPostalCode" class="block text-xs sm:text-sm font-semibold text-slate-700 mb-2">
                                    Postal Code <span class="text-red-500">*</span>
                                </label>
                                <input
                                        id="billingPostalCode"
                                        type="text"
                                        pInputText
                                        formControlName="postalCode"
                                        [class.ng-invalid]="isNestedFieldInvalid('billing', 'postalCode')"
                                        placeholder="Enter postal code"
                                        class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-colors text-sm sm:text-base">
                                <small
                                        *ngIf="isNestedFieldInvalid('billing', 'postalCode')"
                                        class="text-red-500 text-xs mt-1 block">
                                    {{ getNestedFieldError('billing', 'postalCode') }}
                                </small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Proceed Button -->
                <div class="my-2 md:my-4">
                    <p-button
                            label="Proceed to Payment"
                            icon="pi pi-arrow-right"
                            iconPos="right"
                            [loading]="isCreatingOrder"
                            [disabled]="isCreatingOrder || checkoutForm.invalid"
                            (click)="proceedToPayment()"
                            styleClass="w-full md:w-fit">
                    </p-button>
                </div>
            </form>
        </div>
    </div>
</div>